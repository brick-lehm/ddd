# Signup Workflow - ビジネス要求ドキュメント

## 日付
2025-11-04

## 参加者
- ドメインエキスパート（Signup workflow運営者）
- 開発者

---

## 1. 解決すべき課題（What / Why）

### 現状の痛み

- **課題:** サインアップ途中で離脱したユーザーが再度サインアップしようとすると、『既に登録済みのユーザーです』というエラーが発生し、決済情報登録フォームに遷移できない。

- **課題:** 離脱ポイントは主に「サインアップ（認証情報登録）完了後、決済情報登録前」であり、ユーザーがオンボーディングを完了できない状況が発生している。

- **課題:** 運営者が手動で認証情報を削除する対応が必要で、1件あたり30分〜1時間の工数がかかっている。

- **課題:** 手動対応により、他の重要な業務が圧迫されており、事業成長の阻害要因となっている。

- **課題:** 問い合わせをせずに離脱するユーザーが全体の約10%存在し、機会損失が発生している。

- **課題:** ユーザーが問い合わせてから再サインアップ可能になるまで約1時間かかり、ユーザー体験が悪化している。

### 根本原因

- **原因:** システムに「工程の完了状態を管理する仕組み」がない。

- **原因:** サインアップ（認証情報登録）が完了すると、決済情報が未登録でも「サインイン可能なユーザー」として扱われ、再度サインアップしようとすると認証情報の重複チェックでエラーになる。

---

## 2. 達成すべき要求（What）

### 最重要要求

- **要求:** 手動対応をゼロにしたい（最重要目標）

- **要求:** オンボーディング途中で離脱したユーザーが、続きから再開できるようにしたい

### ビジネス要求

- **要求:** 運営者の工数を削減し、他の重要業務に集中できるようにしたい

- **要求:** 10%の「問い合わせせず離脱」ユーザーを救済し、機会損失を削減したい

- **要求:** サインアップ完了率（コンバージョン率）を向上させたい

- **要求:** ユーザーがエラーで困ることなく、スムーズにサインアップを完了できるようにしたい

- **要求:** ユーザーの待ち時間を削減したい（現状1時間 → 即時）

### 技術的要求（What レベル）

- **要求:** 各ユーザーの工程完了状態をシステムで記録・管理したい

- **要求:** 未完了工程への自動遷移機能を実装したい

- **要求:** 再サインイン時またはサインアップ時に、工程の完了状態を判断して適切な画面へ誘導したい

---

## 3. スコープと制約

### 今回のスコープ（対象）

- ✅ 工程は**順番通りに完了**する前提で実装する

- ✅ サインアップの3つの工程（プラン選択、サインアップ、決済情報登録）を管理対象とする

- ✅ オンボーディング途中離脱からの再開機能を実装する

- ✅ 決済失敗時の再試行機能を含める

### 今回のスコープ外（将来対応）

- ❌ 工程の順序変更への対応は今回対象外（将来的には対応したい）

- ❌ 後から戻って変更できる柔軟性は今回不要（将来的には対応したい）

- ❌ 条件による工程スキップ機能は今回対象外（将来的には対応したい）

- ❌ Stripeのwebhook失敗時の自動リトライは今回対象外（人が対応する）

### 将来の拡張性（メモ）

- 工程の順序を柔軟に変更できるようにしたい

- ユーザーが後から情報を変更できるようにしたい

- 新しい工程を柔軟に追加できる設計が望ましい

---

## 4. 成功の指標（KPI）

### 最重要指標

- ✅ **手動対応件数がゼロになること**

### 副次的指標

- サインアップ完了率の向上

- サポート問い合わせ件数の削減

- ユーザー離脱率の改善（現状10%から減少）

---

## 5. ビジネス価値

### 期待される効果

- **サポートコストの削減:** 運営者の工数削減により、他の重要業務に集中できる

- **機会損失の削減:** 10%の離脱ユーザーを救済し、コンバージョン率を向上させる

- **ユーザー満足度の向上:** スムーズなサインアップ体験、待ち時間の削減、エラーストレスの解消

- **事業のスケーラビリティ向上:** ユーザー数が増えても運営コストが増加しない仕組みを構築

---

## 6. ユビキタス言語

このプロジェクトで使用する共通言語については、別ドキュメントで管理しています。

**参照:** [ユビキタス言語_v0.1.md](./ユビキタス言語_v0.1.md)

主要な用語:
- **オンボーディング** = サインアップの全工程
- **オンボード中** = オンボーディング未完了の状態
- **アクティブユーザー** = 全工程完了済みのユーザー
- **工程** = オンボーディングの各ステップ

詳細は上記ドキュメントを参照してください。

---

## 7. 現状のフロー（As-Is）

### 3つの工程

1. **プラン選択**
   - ボタンクリックでプランを選択
   - Cookie に保存（ユーザー未識別のため）
   - 完了条件: サインアップフォームへ遷移時

2. **サインアップ（認証情報登録）**
   - メールアドレス・パスワードを登録
   - 完了条件: ユーザー情報のDB保存時
   - **重要:** この時点でサインイン可能なユーザーとして扱われる

3. **決済情報登録**
   - Stripe経由でクレジットカード情報・請求先情報を登録
   - 完了条件: Stripe決済完了webhook受信時（初回課金完了）

### 問題が発生するシナリオ

**シナリオB:** サインアップ完了後、決済情報登録前に離脱
1. ユーザーが認証情報を登録（DB保存完了）
2. 決済情報登録前にブラウザを閉じる
3. 再度サイトにアクセスし、サインアップボタンを押す
4. 『既に登録済みのユーザーです』エラーが表示される
5. 決済情報登録画面に遷移できない
6. 運営者に問い合わせ（または離脱）

---

## 8. 理想の状態（To-Be）

### 基本コンセプト

**「工程の途中で離脱した場合でも、その途中の工程から再開できる」**

### 理想のユーザー体験

1. ユーザーがサインアップ途中で離脱（例: 決済情報登録前）

2. ユーザーが再度サインアップまたはサインインを試みる

3. システムが工程の完了状態を判断
   - **サインアップボタンを押した場合:** 「既にアカウントがあります。サインインしてください」と案内
   - **サインインボタンを押した場合:** サインイン後、自動的に未完了工程（決済情報登録画面）へ遷移
   - **全工程完了済みの場合:** 通常通りサインイン

4. ユーザーが続きから工程を完了できる

### システムの責務

- 各ユーザーの工程完了状態を記録・管理する

- サインイン時にオンボーディング状態をチェックする

- 未完了工程への自動リダイレクトを行う

- 決済失敗時には再度決済情報登録画面へ遷移させる

---

## 9. 前提条件

### システムの現状

- サインアップ完了 = サインイン可能なユーザーとして扱われる

- 工程の完了状態を管理する仕組みが未実装

### 使用予定技術（参考情報）

- **オーケストレーション:** Temporal（工程管理と状態遷移判断に使用）

- **決済処理:** Stripe（決済情報登録、webhook通知）

---

## まとめ

このプロジェクトの核心は、**「手動対応をゼロにする」ことで運営コストを削減し、ユーザーがスムーズにサインアップを完了できる体験を提供すること**です。

工程の完了状態を管理する仕組みを導入することで、離脱と再開のシナリオに自動的に対応し、ユーザー・運営者双方の痛みを解決します。
